<h1 class="text-3xl font-bold text-gray-900 mb-8">Account</h1>

<div class="grid md:grid-cols-2 gap-8">
  <!-- User Info -->
  <div class="bg-white rounded-lg shadow p-6">
    <h2 class="text-xl font-semibold text-gray-900 mb-4">User Info</h2>
    <dl class="space-y-3">
      <div>
        <dt class="text-sm text-gray-500">Name</dt>
        <dd class="text-sm font-medium text-gray-900"><%= @user.name %></dd>
      </div>
      <div>
        <dt class="text-sm text-gray-500">Email</dt>
        <dd class="text-sm font-medium text-gray-900"><%= @user.email %></dd>
      </div>
      <div>
        <dt class="text-sm text-gray-500">Pay Customer ID</dt>
        <dd class="text-sm font-mono text-gray-900"><%= @payment_processor&.processor_id || "Not yet created" %></dd>
      </div>
    </dl>
  </div>

  <!-- Subscription -->
  <div class="bg-white rounded-lg shadow p-6">
    <h2 class="text-xl font-semibold text-gray-900 mb-4">Subscription</h2>
    <% if @subscription %>
      <dl class="space-y-3">
        <div>
          <dt class="text-sm text-gray-500">Status</dt>
          <dd>
            <% status_colors = { "active" => "bg-green-100 text-green-800", "canceled" => "bg-red-100 text-red-800", "trialing" => "bg-blue-100 text-blue-800" } %>
            <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium <%= status_colors[@subscription.status] || 'bg-gray-100 text-gray-800' %>">
              <%= @subscription.status %>
            </span>
            <% if @subscription.on_grace_period? %>
              <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium bg-yellow-100 text-yellow-800 ml-1">
                Grace Period
              </span>
            <% end %>
          </dd>
        </div>
        <div>
          <dt class="text-sm text-gray-500">Plan (Price ID)</dt>
          <dd class="text-sm font-mono text-gray-900"><%= @subscription.processor_plan %></dd>
        </div>
        <div>
          <dt class="text-sm text-gray-500">Current Period</dt>
          <dd class="text-sm text-gray-900">
            <%= @subscription.current_period_start&.strftime("%B %d, %Y") %> &mdash;
            <%= @subscription.current_period_end&.strftime("%B %d, %Y") %>
          </dd>
        </div>
        <% if @subscription.ends_at %>
          <div>
            <dt class="text-sm text-gray-500">Ends At</dt>
            <dd class="text-sm text-red-600 font-medium"><%= @subscription.ends_at.strftime("%B %d, %Y at %I:%M %p") %></dd>
          </div>
        <% end %>
        <div>
          <dt class="text-sm text-gray-500">Stripe Subscription ID</dt>
          <dd class="text-sm font-mono text-gray-900"><%= @subscription.processor_id %></dd>
        </div>
      </dl>
      <div class="mt-6 flex gap-3">
        <%= link_to "Manage Billing", billing_path, class: "rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white hover:bg-indigo-500" %>
        <%= link_to "Lifecycle Demo", lifecycle_path, class: "rounded-md bg-purple-600 px-3 py-2 text-sm font-semibold text-white hover:bg-purple-500" %>
      </div>
    <% else %>
      <p class="text-gray-500">No active subscription.</p>
      <%= link_to "Choose a Plan", root_path, class: "mt-4 inline-block rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white hover:bg-indigo-500" %>
    <% end %>
  </div>
</div>

<!-- License -->
<div class="mt-8 bg-white rounded-lg shadow p-6">
  <h2 class="text-xl font-semibold text-gray-900 mb-4">Software License</h2>
  <% if @license %>
    <dl class="space-y-3">
      <div>
        <dt class="text-sm text-gray-500">Status</dt>
        <dd>
          <% license_colors = { "active" => "bg-green-100 text-green-800", "cancelled" => "bg-red-100 text-red-800", "expired" => "bg-yellow-100 text-yellow-800" } %>
          <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium <%= license_colors[@license.status] || 'bg-gray-100 text-gray-800' %>">
            <%= @license.status %>
          </span>
        </dd>
      </div>
      <div>
        <dt class="text-sm text-gray-500">License ID</dt>
        <dd class="text-sm font-mono text-gray-900"><%= @license.license_id %></dd>
      </div>
      <div>
        <dt class="text-sm text-gray-500">License Key</dt>
        <dd class="text-sm font-mono text-gray-900 bg-gray-50 p-2 rounded"><%= @license.key %></dd>
      </div>
      <div>
        <dt class="text-sm text-gray-500">Plan</dt>
        <dd class="text-sm font-medium text-gray-900 capitalize"><%= @license.plan %></dd>
      </div>
      <div>
        <dt class="text-sm text-gray-500">Valid Until</dt>
        <dd class="text-sm text-gray-900"><%= @license.expires_at.strftime("%B %d, %Y at %I:%M %p") %></dd>
      </div>
    </dl>
  <% else %>
    <p class="text-gray-500">No license issued yet. Subscribe to a plan to get a license.</p>
  <% end %>
</div>

<!-- Charges -->
<div class="mt-8 bg-white rounded-lg shadow p-6">
  <h2 class="text-xl font-semibold text-gray-900 mb-4">Charges</h2>
  <% if @charges.any? %>
    <table class="min-w-full divide-y divide-gray-200">
      <thead>
        <tr>
          <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
          <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Amount</th>
          <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Stripe ID</th>
          <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        <% @charges.each do |charge| %>
          <tr>
            <td class="px-4 py-3 text-sm text-gray-900"><%= charge.id %></td>
            <td class="px-4 py-3 text-sm font-medium text-gray-900">$<%= "%.2f" % (charge.amount / 100.0) %> <%= charge.currency&.upcase %></td>
            <td class="px-4 py-3 text-sm font-mono text-gray-500"><%= charge.processor_id %></td>
            <td class="px-4 py-3 text-sm text-gray-500"><%= charge.created_at.strftime("%b %d, %Y %I:%M %p") %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <p class="text-gray-500">No charges yet.</p>
  <% end %>
</div>

<!-- Educational callout -->
<div class="mt-8 rounded-lg bg-indigo-50 border border-indigo-200 p-6">
  <h3 class="text-lg font-semibold text-indigo-900">About this page</h3>
  <div class="mt-2 text-sm text-indigo-800 space-y-1">
    <p>This page reads data from Pay gem models: <code class="bg-indigo-100 px-1 rounded">Pay::Customer</code>, <code class="bg-indigo-100 px-1 rounded">Pay::Subscription</code>, <code class="bg-indigo-100 px-1 rounded">Pay::Charge</code></p>
    <p>The "Manage Billing" link uses <code class="bg-indigo-100 px-1 rounded">payment_processor.billing_portal</code> to redirect to Stripe's hosted portal.</p>
    <p>For deeper exploration of all Pay tables, visit the <%= link_to "Explorer", explorer_path, class: "text-indigo-600 underline font-medium" %>.</p>
  </div>
</div>
